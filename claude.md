# Simple Notes App - Dev Docs

Minimalistische Todo-App mit Terminal-Design. Pure Vanilla JavaScript.

**Stack**: HTML5, CSS3, Vanilla JS, LocalStorage, Drag & Drop API

## Datenmodell

```javascript
// Note
{
    id, content, timestamp, stackId,
    category: 'k'|'h'|'p'|'u',  // Kategorien
    uClass: '2a'|'2b'|'2c'|'3a'|'3b'|'5',  // Klassen f√ºr 'u'
    timeMinutes, priority: '!'|'!!'|'!!!',
    focused, assignedDay: 'monday'...'sunday'
}

// Stack
{ id, noteIds: [], type: 'group'|'sequential', title }
```

## Wichtigste Features

### 1. UI & Navigation
- **Single-Line Header**: Kompakte Navigation mit View-Name, Filter, Timer, Stats
- **Filter Command Palette**: Tastatur-driven (Taste `/`)
  - VS Code-inspiriertes Design
  - Kategorien, Klassen, Zeit, Priorit√§t, Tage filtern
  - Aktive Filter als Chips angezeigt (removable mit √ó)
  - Suggestions mit Realtime-Suche
- **Input Modal**: Neue Notes erstellen (Taste `n`)
  - Zentriertes Modal statt always-visible Input
  - 3-zeilige Textarea mit Terminal-Prompt `>`
  - Completed Counter im Header
- **Stack View**: Alle Stacks expandiert zeigen (Taste `s`)
  - Header zeigt "BOARD (STACK VIEW)" in Cyan
  - Beide Stack-Typen (Group + Sequential) werden aufgeklappt
  - Type-Icons: + f√ºr Group, ‚Üí f√ºr Sequential
  - Zur√ºck zu Normal: erneut `s` dr√ºcken

#### Keyboard Shortcuts (Global)
- **/** (Slash): Filter Command Palette √∂ffnen
- **n**: Input Modal √∂ffnen (neue Note erstellen)
- **s**: Stack View toggle (nur in Board View)
- **Cmd+K** (Ctrl+K): Universal Task/Stack Creator Modal √∂ffnen
- **Cmd+Z** (Ctrl+Z): Undo (letzte Aktion r√ºckg√§ngig machen)
- **ESC**: Modals schlie√üen (Input, Filter, Stack Modal, Creator Modal)

### 2. Plan View
- **Zen Mode**: Header und Sidebar versteckt, nur Editor + Action-Buttons
- **Typewriter Scrolling**: Aktuelle Zeile bleibt immer vertikal zentriert
- **Editor**: 50vh Padding oben/unten, w√§chst mit Content
- Auto-Task: `(Task 30m --k !!)` ‚Üí Karte + gr√ºnes `[...] ‚úì`
- **Stack-Bl√∂cke**: Mehrere Tasks als Stack erstellen
- **Universal Creator Icons**: Wei√üe Task-Icons, lila Stack-Icons (klickbar zum Bearbeiten)
- **Icon Insertion**: Inline im Text, Cursor automatisch nach Icon + Space
- **Parsing-Order**: Kategorie ‚Üí Priorit√§t ‚Üí Zeit
- Storage: `planText` als innerHTML (nicht plain text!)

#### Keyboard Shortcuts (Plan View)
- **Cmd+B** (Ctrl+B): Bold
- **Cmd+I** (Ctrl+I): Italic
- **Cmd+Shift+8** (Ctrl+Shift+8): Bullet List
- **Cmd+Shift+C** (Ctrl+Shift+C): Checkbox
- **Cmd+Enter** (Ctrl+Enter): Stack erstellen (Alternative zu `/` Trigger)
- **Cmd+Z** (Ctrl+Z): Undo (letzte Aktion r√ºckg√§ngig machen)

#### Stack-Block-Syntax
```
seq: Stack Titel
- Task 1 30m --k
- Task 2 45m --h !!
- Task 3 20m --p
/  (oder Cmd+Enter)
```
- **Trigger**: `/` auf neuer Zeile ODER **Cmd+Enter** (f√ºgt `/` automatisch ein)
- **Typen**: `seq:` = Sequential (‚Üí), `group:` = Group (+)
- **Parsing**: Jeder Bullet wie normaler Task (Zeit, Kategorie, Prio)
- **Reihenfolge**: Erste Task = Oberste Karte im Stack
- **Best√§tigung**: `seq: Stack Titel [‚Üí 3 Tasks] ‚úì` (gr√ºn, fade-in)
- **Check**: Stack mit gleichem Titel wird nicht doppelt erstellt
- **Debouncing**: Parsing l√§uft erst 300ms nach letzter Eingabe (Performance)
- **Cmd+Enter**: Bypassed Debouncing, triggert sofort

### 3. Kategorien
- `--k` (t√ºrkis), `--h` (gelb), `--p` (rot), `--u` (lila)
- Unterricht: `--u2a`, `--u2b`, etc. ‚Üí Badge + Filter
- **Wichtig**: `--u` Parsing VOR anderen!

### 4. Zeit & Sessions
- Format: `30m`, `125m`
- **Work Timer im Header**: Start/Pause/Stop mit "bis HH:MM" Anzeige
- **Session Summary Modal**: Zeigt Stats nach Timer-Ende oder letztem Task completed
  - Geplante vs. tats√§chliche Zeit
  - "Gespart: +15m" (gr√ºn) oder "Mehr: -10m" (rot)
  - Erscheint automatisch bei zwei Szenarien:
    1. Timer l√§uft ab
    2. Letzter offener Task wird erledigt (‚óã)
- **Background Timer**: L√§uft mit `Date.now()`, funktioniert auch wenn Tab inaktiv
- localStorage: `lastSessionData` (24h Ablauf)

### 5. Priorit√§ten
- Syntax: `!`, `!!`, `!!!`
- **Wichtig**: Als String speichern, nicht Number!

### 6. Stacking
- Drag auf Karte ‚Üí Stack
- Typen: Group (+) = alle aktiv, Sequential (‚Üí) = nur Top aktiv
- Stack Modal: Klick ‚Üí ‚Üë‚Üì Reorder, ‚á¢ Unstack
- **Group Stack Unstacking (Board View)**: Wenn Filter aktiv, zeigt Group-Stacks Karten in dedizierten Zeilen
  - Jede Gruppe bekommt eigene Zeilen (Row-basierte Gruppierung)
  - Wei√üer gestrichelter Balken links (60px breit) mit vertikalem Gruppennamen
  - Karten k√∂nnen auf mehrere Zeilen umbrechen, Balken erstreckt sich √ºber gesamte H√∂he
  - Keine anderen Karten zwischen Gruppen-Zeilen
  - CSS: `.group-row-wrapper` (full-width), `.group-row-sidebar` (dashed border), `.group-row-label` (vertical text)
  - Sequential-Stacks bleiben gestackt auch bei Filtern
  - **Nur Board View**: In Kanban bleiben Gruppen normal (farbige Borders)

### 7. Kanban
- 8 Spalten: Unassigned + Mo-So
- Drag zwischen Tagen
- Filter: Zeit/Kategorie, keine Tag-Filter

### 8. Completed Counter
- Z√§hlt erledigte Tasks heute
- Auto-Reset bei Mitternacht
- **Nur** bei Complete (‚óã), nicht bei Delete!
- Angezeigt in Input Modal Header

### 9. Undo System
- **Cmd+Z** (Ctrl+Z) macht letzte Aktion r√ºckg√§ngig
- **Unterst√ºtzt**: Note/Stack Creation, Note Deletion, Note Completion
- **History**: Bis zu 10 Aktionen im `undoStack`
- **Stack Undo**: Entfernt Stack UND alle dazugeh√∂rigen Notes
- **Scope**: Funktioniert global, au√üer in Input/Textarea (au√üer Plan Editor)
- **Wichtig**: Undo entfernt Notes permanent (nicht nur complete)

### 10. Visuelle Animationen
- **Stack/Task Creation**: Fade-in Animation (0.5s) f√ºr gr√ºne Best√§tigung in Plan View
- **Neue Karten**: Opacity-basierter Pulse-Effekt (2 Pulses, 1.4s) f√ºr neu erstellte Notes
- **Tracking**: `newlyCreatedNoteIds` Set speichert IDs bis View-Switch
- **Trigger**: Animation startet automatisch beim Switch zu Board/Kanban View
- **Cleanup**: Nach 1s werden IDs aus Set entfernt, Animation endet automatisch

### 11. Universal Task/Stack Creator Modal (Cmd+K)
- **Zugriff**: Cmd+K (Ctrl+K) in Board oder Plan View
- **Features**:
  - Erstelle Tasks oder Stacks mit vollst√§ndigem GUI
  - Alle Felder: Content, Zeit, Kategorie, Priorit√§t, Tag
  - Multiple Tasks hinzuf√ºgen ‚Üí Stack-Optionen erscheinen
  - Stack-Typen: None, Group (+), Sequential (‚Üí)
  - Reorder Tasks mit ‚Üë‚Üì Buttons
  - Einzelne Tasks entfernen mit √ó Button
- **Edit Mode**: Klick auf Icon √∂ffnet Modal zum Bearbeiten
  - Tasks: Alle Felder editierbar
  - Stacks: Tasks doppelklicken zum Bearbeiten, Enter zum n√§chsten
  - Sequential Editing: Mehrere Tasks nacheinander bearbeiten
  - Visuelles Feedback: Gr√ºner Button, blaue Border bei aktiver Task
- **Plan View Integration**:
  - Icons werden inline im Text eingef√ºgt
  - Wei√üe Icons f√ºr Tasks, lila Icons f√ºr Stacks
  - Zeigen Namen/Titel (nicht nur Symbole)
  - Cursor automatisch nach Icon + Leerzeichen
  - Empty DIV Detection: Icons vor leeren `<div>` einf√ºgen (bleibt inline)
  - setTimeout(10ms) f√ºr Cursor-Fokus nach Modal-Close
  - **Tabellen-Integration**: Tasks/Stacks k√∂nnen in Tabellenzellen erstellt werden
    - Saved Range: Cursor-Position wird vor Modal-Open gespeichert
    - Icons werden korrekt in fokussierter Zelle eingef√ºgt

### 12. Plan View Tabellen
- **Markdown-Style Syntax**: `| Header1 | Header2 |` erstellt Tabelle bei Enter
  - Auto-Separator: Nutzer muss keine `| ---- |` Zeile eingeben
  - Auto-Empty Row: Nur Header n√∂tig, erste Zeile wird automatisch erstellt
- **Full-Width Layout**: Tabellen nutzen volle Breite, Spalten verteilen sich automatisch
- **Editable Cells**: Alle Zellen (th/td) sind contentEditable
- **Tab Navigation**: Tab/Shift+Tab zum Navigieren zwischen Zellen
- **Action Buttons**:
  - **+ Row** / **+ Column**: Zeilen/Spalten hinzuf√ºgen
  - **‚Üë Zeile** / **Zeile ‚Üì**: Zeile nach oben/unten verschieben
  - **‚Üê Spalte** / **Spalte ‚Üí**: Spalte nach links/rechts verschieben
  - **√ó Delete Table**: Tabelle mit Best√§tigung l√∂schen
- **Focus Tracking**: Tabelle speichert zuletzt fokussierte Zelle in `table._lastFocusedCell`
  - N√∂tig weil Button-Click den Fokus von Zelle zu Button verschiebt
  - Alle Zellen haben `focus` Event Listener
- **Styling**:
  - Header: Wei√üer Hintergrund, schwarzer fetter Text
  - Buttons: Wei√üer Text, wei√üer Hover-Rand (Delete-Button: rot beim Hover)
  - Focus: T√ºrkiser Outline f√ºr aktive Zelle
- **Backwards Compatibility**: `updateExistingTables()` f√ºgt neue Buttons zu alten Tabellen hinzu

### 13. Google Calendar Integration (v112)
- **OAuth 2.0 mit Google Identity Services (GIS)**
  - Read-only Zugriff auf alle Google Kalender
  - Neue GIS API (migriert von deprecated `gapi.auth2`)
  - OAuth Flow: `google.accounts.oauth2.initTokenClient()`
  - Access Token Management: `gapi.client.setToken()`
  - Credentials in localStorage gespeichert
- **Multi-Calendar Support**:
  - Fetcht Events von **allen** Kalendern (nicht nur primary)
  - Unterst√ºtzt: KSWIL, Familie, Privat, Holidays, etc.
  - Excludiert automatisch: "Week Numbers" Kalender
  - Parallel API Calls f√ºr bessere Performance
- **Button in Time Availability Section**:
  - "üìÖ Google Calendar verbinden" (blau)
  - Wird gr√ºn: "‚úì Google Calendar verbunden"
  - Click zum Sign-in/Sign-out Toggle
- **Event Fetching**:
  - `fetchTodaysEvents()`: Heutige Events f√ºr AI Briefing
  - `fetchWeekEvents()`: N√§chste 7 Tage f√ºr Wochen√ºberblick
  - Events enthalten: summary, time, location, calendarName
  - Sortiert nach Startzeit

### 14. AI Briefing mit Calendar Events (v112)
- **Keyboard Shortcut**: Cmd+Shift+B (Ctrl+Shift+B)
- **Drei Hauptsektionen**:
  1. **Kalender Events (heute)**: Nur Google Calendar Events
     - Format: `üìÖ HH:MM-HH:MM: Event Name [Kalender]`
     - Excludiert "Week Numbers" Kalender
     - Mit Location falls vorhanden
  2. **Zeitplan (Tasks)**: Berechneter Zeitplan aus Time Availability
     - Emoji-basiert (üî•‚ö°üìöüíºüéìüè†)
     - Mit Kategorie, Priorit√§t, Dauer
     - Task-Splitting falls n√∂tig
  3. **Wochenausblick**: N√§chste 7 Tage (ab morgen)
     - Alle Calendar Events mit Tag, Uhrzeit, Kalender
     - Wichtige Tasks (!! oder !!!)
     - Als Flie√ütext formatiert (nicht als Liste)
- **Prompt Engineering**:
  - KI bekommt strukturierte Daten (JavaScript macht Berechnungen)
  - Anweisung: "Kopiere 1:1" f√ºr exakte Zeitangaben
  - Flie√ütext f√ºr Wochenausblick (nicht technisch)
  - Markdown-to-HTML Konvertierung f√ºr sch√∂ne Darstellung
- **Ollama Integration**:
  - Lokales Model: `gemma3:4b`
  - Endpoint: `http://127.0.0.1:11434/api/generate`
  - Fallback mit hilfreichen Fehler-Messages

## Kritische Implementierungsdetails

### Parsing-Reihenfolge (addNote)
```javascript
// 1. Kategorie (--u2a, --k, --h, --p)
// 2. Priorit√§t (!!)
// 3. Zeit (30m)
// 4. Content = Rest
// WICHTIG: Kategorie ZUERST!
```

### Edit-Modus
- Original-Werte: `note._originalContent`, `_originalCategory`, `_originalTime`
- Enter speichert, ESC restored

### Stack Cleanup
```javascript
// Beim Delete/Complete:
stacks.forEach(s => s.noteIds = s.noteIds.filter(id => id !== noteId));
stacks = stacks.filter(s => s.noteIds.length > 0);
```

### Filter-Logik
- **Command Palette Integration**: Filter via Keyboard (`/`) oder Button-Click
- **Filter-ID Format**: `type-value` (z.B. `time-0-15`, `category-k`)
  - **Wichtig**: Nur ersten Dash splitten (preserve `0-15` in `time-0-15`)
- **Mapping zu alten Buttons**: Palette aktiviert Legacy-Filter-Buttons im Hintergrund
- Kategorie: OR
- Zeit: OR
- Tags: OR
- Zwischen Typen: AND
- Sequential Stacks: Nur Top-Karte filtern

## Design-Entscheidungen

- **Keine Frameworks**: Minimale Gr√∂√üe, volle Kontrolle
- **LocalStorage**: Keine Backend-Infrastruktur
- **ContentEditable**: Native Rich Text besser als Markdown-Parsing
- **HTML Storage**: innerHTML statt textContent (bewahrt Formatierung)
- **Command Palette statt Button-Grid**: Keyboard-first UX, weniger visueller Clutter
- **Modal-basierter Input**: Fokussiertes Erstellen ohne permanentes UI-Element
- **Backward Compatibility**: Neue Filter-Palette nutzt alte Filter-Button-Logik (click events)
- **Header-Timer**: Wichtigste Info immer sichtbar, kein Sidebar-Scrolling n√∂tig

## Wichtige Bugs/Fixes

1. **Priorit√§t als String**: `'!!'` nicht als Number speichern
2. **updateWorkSidebar**: Timer nicht auto-stoppen ‚Üí race condition
3. **Cursor-Management**: Nach Task-Creation aus gr√ºnem Span bewegen
4. **--u Parsing**: Vor anderen Kategorien parsen
5. **Session Stats**: localStorage persistent, nicht nur in Sidebar
6. **Stack-Block Parsing**: Trigger (`/`) n√∂tig, sonst wird bei jedem Input neu erstellt
7. **Stack Zeit-Addition**: Summe aller Tasks (auch bei Sequential), nicht nur Top-Card
8. **getPlainText()**: `<br>` und `<div>` zu `\n` konvertieren f√ºr Regex-Matching
9. **Zeit-Filter Split Bug**: `split('-')` auf `time-0-15` zerbrach Value ‚Üí nur ersten Dash splitten
10. **Timer Display**: `display: 'block'` verhinderte Flex-Layout ‚Üí `display: 'flex'` n√∂tig
11. **Session Summary Modal**: `display: 'block'` statt `'flex'` ‚Üí Modal nicht korrekt zentriert
12. **startTime TypeError**: `startTime.getTime()` failed ‚Üí startTime ist bereits Number, nicht Date

## LocalStorage Keys

- `simpleNotes`: Note-Array
- `simpleStacks`: Stack-Array
- `planText`: Plan View HTML
- `lastSessionData`: Session-Statistik
- `completedCounter`: { count, date }
- `backupSettings`: IndexedDB f√ºr Auto-Backup
- `googleClientId`: Google OAuth Client ID (v112)
- `googleApiKey`: Google API Key (v112)

## Button-Layout

**Normal**: √ó | Zeit | ... | ‚óã | ‚ãÆ
**Modal**: √ó | Zeit | ‚Üë | ‚Üì | ... | ‚á¢ | ‚óã | ‚ãÆ

## Datei-Struktur

- **index.html**: Main HTML mit Header, Modals, Views
- **app.js**: Core App-Logik (Notes, Stacks, Timer, Filters, Typewriter Scrolling)
- **ui-redesign.js**: UI-Layer (Filter Palette, Input Modal, Header Updates)
- **task-creator.js**: Universal Task/Stack Creator Modal (Cmd+K)
- **style.css**: Alle Styles (Header, Modals, Cards, Animations, Zen Mode)
- **sw.js**: Service Worker f√ºr PWA (Cache-Versioning)
- **manifest.json**: PWA Manifest
- **CLAUDE.md**: Dev Docs (dieses File)

## Entwickelt mit Claude Code

**Lessons Learned**:
- Parsing-Reihenfolge kritisch
- CSS Variables f√ºr dynamische Farben
- LocalStorage braucht Cleanup
- Animations-Timing wichtig (300ms debounce, 1s animation)
- Modal besser als Inline f√ºr komplexe Interaktionen
- Buttons besser als Drag & Drop f√ºr Reordering
- Event-Listener Duplikation vermeiden
- ContentEditable + `execCommand()` f√ºr Rich Text
- **Explizite Trigger** (wie `/`) besser als implizite (Leerzeile, EOF) f√ºr User-Actions
- **Keyboard Shortcuts** als Alternative zu visuellen Triggern (Cmd+Enter statt `/`)
- **HTML-zu-Text-Konvertierung** muss Newlines preservieren (`<br>`/`<div>` ‚Üí `\n`)
- **Stack-Block-Parsing**: Bei `input` Event l√§uft Code oft (Performance beachten!)
- **Debouncing**: 300ms Delay = bessere Performance ohne sp√ºrbare Latenz
- **Animation-Timing**: Trigger bei View-Switch, nicht bei Creation (besseres UX)
- **Visuelles Feedback**: CSS-Animationen mit `setTimeout` cleanup nach Animation-Ende
- **Undo-System**: Simple Stack-basierte History reicht f√ºr 90% Use Cases
- **newlyCreatedNoteIds Set**: Tempor√§res Tracking f√ºr Animations-State zwischen Views
- **Opacity-Animationen** besser als Transform f√ºr subtile Effekte (weniger aufdringlich)
- **Visuelle Gruppierungs-Indikatoren**: Row-basierte Gruppierung besser als einzelne Borders oder SVG-Linien
- **Grid-Layout Flexibilit√§t**: Full-width Wrapper (`grid-column: 1 / -1`) + inneres Grid = flexible Zeilen-Gruppierung
- **Vertikaler Text**: `writing-mode: vertical-rl` + `transform: rotate(180deg)` f√ºr lesbare vertikale Labels
- **Dashed Borders**: Besser als solid/colored f√ºr subtile visuelle Trennung
- **Dedicated Rows**: Keine gemischten Karten = klare Gruppierung, einfacher zu scannen
- **UI Redesign (v12-v37)**:
  - Command Palette >> Button Grid (weniger visueller Clutter)
  - Modal Input >> Always-visible (Fokus + cleaner UI)
  - Header Timer >> Sidebar (wichtigste Info immer sichtbar)
  - Single-Line Header >> 3-Row Header (kompakter, professioneller)
  - Keyboard-first Design (`/`, `n`, `s`) = schnellere Workflows
  - Filter-ID String-Splitting: Nur ersten Dash beachten (preserve komplexe Values)
  - Display-Properties beachten: `flex` vs `block` f√ºr Layout-Struktur
  - startTime als Number (timestamp), nicht Date-Object speichern
  - Session Summary Modal: 2 Trigger-Szenarien (Timer + Last Task)
- **Plan Mode Zen & Creator (v54-v59)**:
  - Zen Mode: body.zen-mode class f√ºr beide switchView Funktionen
  - Typewriter Scrolling: Container scrollbar, Editor mit 50vh Padding
  - Universal Creator: Separates Modul (task-creator.js) f√ºr saubere Trennung
  - Icon Insertion: Empty DIV Detection + setTimeout f√ºr Cursor-Fokus
  - Inline Icons: insertBefore() statt appendChild() bei leeren Divs
  - Sequential Editing: State Management mit editingTaskId variable
  - Visual Feedback: Button colors + border f√ºr aktive Edit-States
  - Plan-Actions Visibility: display:none default, nur bei zen-mode flex
- **Plan View Tabellen (v85-v98)**:
  - Markdown-Parsing: Nur Header + Enter = vollst√§ndige Tabelle (Auto-Separator + Auto-Row)
  - Focus Tracking: Element-Property (`table._lastFocusedCell`) statt `document.activeElement`
    - Button-Clicks verschieben Fokus ‚Üí gespeicherte Referenz n√∂tig
  - Saved Range f√ºr Modal: `range.cloneRange()` vor Modal-Open speichern
    - Modals l√∂schen Selection ‚Üí Range muss in Context gespeichert werden
  - DOM Tree Walking: `while` Loop nach oben bis TD/TH gefunden (table cell detection)
  - Event Listener auf Cells: Jede neue Zelle braucht Focus-Listener (addRow/addColumn)
  - updateExistingTables(): Backwards compatibility beim Load f√ºr alte Tabellen
  - Separate Hover-States: Header (`#f0f0f0`) vs Body (`rgba(...)`) f√ºr bessere UX
- **Completed State Visualization (v99-v100)**:
  - Task/Stack Icons im Plan Mode zeigen completion status
  - `data-note-id` und `data-stack-id` Attribute f√ºr Icon-Note-Verkn√ºpfung
  - `.task-icon.completed` CSS-Klasse f√ºr durchgestrichenen, grauen Look
  - `updatePlanTaskIcons()` Funktion checkt alle Icons gegen notes/stacks Array
  - Stack completed wenn alle Notes gel√∂scht/completed sind
  - Updates bei: toggleComplete(), loadPlanText(), undo()
  - Icon-Tracking funktioniert f√ºr beide Erstellungsmethoden (inline syntax + Cmd+K)
- **Global Table Action Buttons (v101)**:
  - Alle Tabellen-Buttons jetzt global in Plan Actions (statt per-table)
  - 7 Buttons: + Row, + Column, ‚Üë Zeile, Zeile ‚Üì, ‚Üê Spalte, Spalte ‚Üí, √ó Delete
  - `currentFocusedTable` Variable trackt fokussierte Tabelle
  - `setCurrentFocusedTable()` wird bei Cell-Focus aufgerufen
  - `updateTableButtonsState()` enabled/disabled Buttons basierend auf Fokus
  - Buttons disabled bis Tabellenzelle fokussiert ist
  - updateExistingTables() entfernt alte per-table Button-Divs
  - Konsistentes Styling mit Speichern/Neue Notiz Buttons
  - Visual Divider trennt normale von Tabellen-Buttons
- **Google Calendar Integration (v111-v112)**:
  - **Migration von gapi.auth2 zu GIS**: Deprecated API ‚Üí Google Identity Services
    - Problem: `idpiframe_initialization_failed` bei neuen Clients
    - L√∂sung: `google.accounts.oauth2.initTokenClient()` statt `gapi.auth2.getAuthInstance()`
    - Token Management: `gapi.client.setToken({ access_token })` manuell setzen
  - **Multi-Calendar Fetching**: Promise.all() f√ºr parallele API Calls
    - Alle Kalender fetchen, nicht nur "primary"
    - Events mit `_calendarName` Property markieren
  - **Week Numbers Kalender**: Automatisch excludieren (kein User-Content)
  - **Popup Blocking**: OAuth muss direkt aus User-Click kommen, nicht setTimeout
    - Erst Init ‚Üí User klickt nochmal ‚Üí dann OAuth Popup
  - **Wochen√ºberblick Formatting**:
    - Problem: KI fasst zu kurz zusammen oder kopiert Tasks als Events
    - L√∂sung: Explizite Anweisungen "Kopiere NUR Kalender Events", "NICHT die Tasks"
    - Flie√ütext statt technische Liste f√ºr bessere Lesbarkeit
  - **Credentials Storage**: localStorage f√ºr Client ID und API Key
    - Prompt beim ersten Mal, dann persistent
    - Keine Secrets im Code (user provides own)

## Phase 3: Kanban ‚Üí Kalender Transformation (WIP - v102+)

### Konzept

**Problem mit altem Kanban:**
- Statische Wochentage (Mo-So) ohne konkrete Daten
- Keine echten Deadlines/Termine
- Umst√§ndliches Handling

**Neue L√∂sung: Monatskalender-Ansicht**
- Zeigt ganzen Monat als Grid
- Backlog-Spalte links f√ºr unzugewiesene Tasks
- Drag & Drop von Backlog zu Kalendertag weist echtes Datum zu
- Echte Termine statt abstrakte Wochentage

### Datenmodell-√Ñnderung

**ALT:**
```javascript
{
  assignedDay: 'monday'  // abstrakt, relativ
}
```

**NEU:**
```javascript
{
  dueDate: '2025-10-21'  // konkret, ISO-Format (YYYY-MM-DD)
}
```

**Warum ISO-Format (YYYY-MM-DD):**
- Menschenlesbar und debuggbar
- Standard in JavaScript: `new Date('2025-10-21')`
- Einfache String-Vergleiche und Sortierung
- Kein Timezone-Chaos

### Layout-Konzept

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   BACKLOG       ‚îÇ  < Oktober 2025 >      [Heute]          ‚îÇ
‚îÇ                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [Task 1]       ‚îÇ  Mo  Di  Mi  Do  Fr  Sa  So             ‚îÇ
‚îÇ  [Task 2]       ‚îÇ ‚îå‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ  [Task 3]       ‚îÇ ‚îÇ  ‚îÇ  ‚îÇ1 ‚îÇ2 ‚îÇ3 ‚îÇ4 ‚îÇ5 ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ ‚îú‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚î§                 ‚îÇ
‚îÇ  Drag Tasks ‚Üí   ‚îÇ ‚îÇ6 ‚îÇ7 ‚îÇ8 ‚îÇ9 ‚îÇ10‚îÇ11‚îÇ12‚îÇ                 ‚îÇ
‚îÇ  zum Datum      ‚îÇ ‚îú‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚î§                 ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ13‚îÇ14‚îÇ15‚îÇ16‚îÇ17‚îÇ18‚îÇ19‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ ‚îú‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚î§                 ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ20‚îÇ21‚îÇ22‚îÇ23‚îÇ24‚îÇ25‚îÇ26‚îÇ  ‚Üê Heute       ‚îÇ
‚îÇ                 ‚îÇ ‚îú‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚î§                 ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ27‚îÇ28‚îÇ29‚îÇ30‚îÇ31‚îÇ  ‚îÇ  ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ ‚îî‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îò                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Features

**1. Kalender-Grid**
- Zeigt aktuellen Monat (default: heute)
- 7 Spalten (Mo-So), ~5-6 Zeilen
- Jede Zelle = 1 Tag mit Tasks

**2. Backlog-Spalte**
- Alle Tasks ohne `dueDate`
- Fixed width links (ca. 300px)
- Scrollable bei vielen Tasks
- Gleiche Card-Darstellung wie Board View

**3. Monatsnavigation**
- `< Oktober 2025 >` Header mit Vor/Zur√ºck-Buttons
- "Heute" Button springt zu aktuellem Monat
- Aktueller Monat wird in State gespeichert

**4. Visuelle States**
- **Heute**: T√ºrkiser Border/Highlight
- **Vergangene Tage**: Leicht grau/ausgegraut (Tasks bleiben sichtbar)
- **Wochenende**: Optional andere Hintergrundfarbe
- **Mit Tasks**: Badge mit Count

**5. Tasks in Zellen**
- Kompakte Card (nur Titel + Zeit)
- Hover: Volle Info (Tooltip oder Expand)
- Click: Edit Modal
- Mehrere Tasks: Scrollbar oder Stacked View
- Drag & Drop Support

**6. Drag & Drop**
- Backlog ‚Üí Kalendertag: Setzt `dueDate`
- Tag ‚Üí Tag: √Ñndert `dueDate`
- Tag ‚Üí Backlog: Entfernt `dueDate` (setzt auf `null`)
- Ganzer Stack wird zusammen verschoben

**7. Filter-Anpassung (Board View)**
- Tag-Filter (Mo-So) beziehen sich auf **aktuelle Woche**
- Montag-Filter = nur Montag dieser Woche
- Vergangene Tage vorerst nicht ausgeblendet
- Sp√§ter: Warnung f√ºr √ºberf√§llige Tasks

### Implementierungs-Plan

**Phase 1: Basis-Struktur (v102)**
- [ ] HTML: Backlog-Spalte + Kalender-Grid mit statischem Monat
- [ ] CSS: Grid-Layout (7 Spalten), Backlog-Spalte fixed width
- [ ] JavaScript: Monatsdaten generieren (Tage-Array)
- [ ] JavaScript: `renderCalendar()` Funktion
- [ ] Statischer Test-Monat (z.B. Oktober 2025)

**Phase 2: Navigation (v103)**
- [ ] State: `currentMonth` und `currentYear` Variablen
- [ ] Monatsnavigation: Vor/Zur√ºck-Buttons
- [ ] "Heute" Button zum Zur√ºckspringen
- [ ] Month/Year Display im Header
- [ ] Monat speichern in localStorage (optional)

**Phase 3: Drag & Drop (v104)**
- [ ] Drag-Handler f√ºr Cards (bereits vorhanden, anpassen)
- [ ] Drop-Zones f√ºr Kalenderzellen
- [ ] Drop-Handler: Setzt `dueDate` auf ISO-Datum
- [ ] Drag zur√ºck zu Backlog: Entfernt `dueDate`
- [ ] Visual Feedback beim Drag (Highlight Drop-Zone)

**Phase 4: Migration & Polish (v105)**
- [ ] Migration: `assignedDay` ‚Üí `dueDate` beim App-Start
- [ ] Converter-Funktion: `getNextDayOfWeek('monday')` ‚Üí ISO
- [ ] Visuelle States: Heute-Highlight, Vergangene Tage
- [ ] Filter anpassen: Tag-Filter auf aktuelle Woche
- [ ] Empty States (leere Zellen, leerer Backlog)
- [ ] Performance: Nur sichtbare Zellen rendern (optional)

### Migration-Strategie

```javascript
// Beim App-Load: Migriere alte assignedDay zu dueDate
function migrateAssignedDayToDueDate() {
  let migrated = 0;

  this.notes.forEach(note => {
    if (note.assignedDay && !note.dueDate) {
      // Konvertiere 'monday' ‚Üí n√§chsten Montag ab heute
      note.dueDate = getNextDayOfWeek(note.assignedDay);
      delete note.assignedDay;
      migrated++;
    }
  });

  if (migrated > 0) {
    console.log(`Migrated ${migrated} notes from assignedDay to dueDate`);
    this.saveNotes();
  }
}

function getNextDayOfWeek(dayName) {
  const days = {
    monday: 1, tuesday: 2, wednesday: 3, thursday: 4,
    friday: 5, saturday: 6, sunday: 0
  };

  const today = new Date();
  const targetDay = days[dayName];
  const currentDay = today.getDay();

  let daysUntilTarget = targetDay - currentDay;
  if (daysUntilTarget <= 0) daysUntilTarget += 7; // N√§chste Woche

  const targetDate = new Date(today);
  targetDate.setDate(today.getDate() + daysUntilTarget);

  return targetDate.toISOString().split('T')[0]; // 'YYYY-MM-DD'
}
```

### Technische Details

**Kalender-Generierung:**
```javascript
function generateCalendarMonth(year, month) {
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);

  const firstDayOfWeek = firstDay.getDay(); // 0 = Sunday
  const daysInMonth = lastDay.getDate();

  // Offset f√ºr Montag-Start (Mo = 0)
  const offset = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

  const weeks = [];
  let week = new Array(offset).fill(null); // Empty cells vor Monatsbeginn

  for (let day = 1; day <= daysInMonth; day++) {
    week.push({
      date: `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`,
      day: day,
      isToday: isToday(year, month, day),
      isPast: isPast(year, month, day)
    });

    if (week.length === 7) {
      weeks.push(week);
      week = [];
    }
  }

  // Letzte Woche mit Empty Cells auff√ºllen
  if (week.length > 0) {
    while (week.length < 7) week.push(null);
    weeks.push(week);
  }

  return weeks;
}
```

**Filter f√ºr aktuelle Woche:**
```javascript
function getCurrentWeekDates() {
  const today = new Date();
  const currentDay = today.getDay();
  const monday = new Date(today);

  // Montag dieser Woche
  const daysFromMonday = currentDay === 0 ? 6 : currentDay - 1;
  monday.setDate(today.getDate() - daysFromMonday);

  const weekDates = {};
  ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday']
    .forEach((day, index) => {
      const date = new Date(monday);
      date.setDate(monday.getDate() + index);
      weekDates[day] = date.toISOString().split('T')[0];
    });

  return weekDates;
}
```

### Offene Fragen / Sp√§ter

- [ ] Was passiert mit √ºberf√§lligen Tasks? (Warnung, Auto-Move, nichts)
- [ ] Multi-Monat-View (Quartal, Jahr)?
- [ ] Wiederholende Tasks (Recurring)?
- [ ] Kalender-Export (iCal)?
- [ ] Sprint/Milestone-Marker im Kalender?
