<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Minimalist todo manager with terminal design">
    <meta name="theme-color" content="#0f0f0f">
    <title>Simple Notes App</title>
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="manifest" href="manifest.json?v=37">
    <link rel="stylesheet" href="style.css?v=37">
</head>
<body>
    <div class="app-container">
        <div class="main-content">
        <!-- Header: New Single-Line Design -->
        <header class="app-header">
            <div class="header-main">
                <button class="hamburger-menu-btn" id="hamburgerMenuBtn" title="Menü">
                    <span class="hamburger-icon">☰</span>
                </button>
                <!-- Hamburger Dropdown Menu -->
                <div class="hamburger-dropdown" id="hamburgerDropdown" style="display: none;">
                    <div class="dropdown-section">
                        <h4 class="dropdown-title">Backup</h4>
                        <button class="dropdown-btn" id="selectBackupFolder" title="Backup-Ordner auswählen">
                            ⊞ Ordner wählen
                        </button>
                        <button class="dropdown-btn" id="manualBackup" title="Backup jetzt erstellen" disabled>
                            ⊡ Backup
                        </button>
                        <button class="dropdown-btn" id="importBackup" title="Backup wiederherstellen">
                            ⊟ Import
                        </button>
                        <div class="backup-status" id="backupStatus">Kein Ordner gewählt</div>
                    </div>
                </div>

                <div class="header-view-name" id="headerViewName">BOARD</div>
                <span class="note-count">0 notes</span>

                <div class="header-stats" id="timeStats"></div>

                <div class="header-actions">
                    <!-- Work Timer in Header -->
                    <div class="header-work-section" id="headerWorkSection" style="display: none;">
                        <div class="header-work-time">
                            <span class="header-work-time-value" id="workTimeTotal">0m</span>
                        </div>
                        <div class="header-work-timer" id="workTimer" style="display: none;">
                            <span class="header-timer-display" id="timerDisplay">00:00:00</span>
                            <span class="header-end-time" id="endTimeDisplay" style="display: none;">
                                bis <span id="endTimeValue">--:--</span>
                            </span>
                            <button class="header-timer-btn" id="pauseBtn" title="Pause">‖</button>
                            <button class="header-timer-btn" id="stopBtn" title="Stop">□</button>
                        </div>
                        <button class="header-start-work-btn" id="startWorkBtn">▶ Start</button>
                    </div>

                    <button class="filter-palette-trigger" id="filterPaletteTrigger" title="Filter öffnen (/)">
                        <span id="filterActiveCount">Filter</span>
                    </button>

                    <div class="undo-container">
                        <button class="undo-btn" id="undoBtn" title="Rückgängig (Cmd+Z)" disabled>
                            <span class="undo-icon">↶</span>
                            <span class="undo-count">0</span>
                        </button>
                        <!-- Undo History Dropdown -->
                        <div class="undo-dropdown" id="undoDropdown" style="display: none;">
                            <div class="undo-dropdown-header">
                                <span class="undo-dropdown-title">Verlauf</span>
                                <button class="undo-dropdown-close" id="undoDropdownClose">×</button>
                            </div>
                            <div class="undo-history-list" id="undoHistoryList">
                                <!-- History items will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <button class="view-switch-btn" id="viewSwitchBtn" title="Ansicht wechseln">
                        <span class="view-icon">⊞</span>
                        <span class="view-label">Kanban</span>
                    </button>
                </div>
            </div>

            <!-- Filter Chips (only visible when filters active) -->
            <div class="filter-chips-bar" id="filterChipsBar" style="display: none;">
                <span class="filter-chips-label">Aktiv:</span>
                <div class="filter-chips-container" id="filterChipsContainer"></div>
            </div>
        </header>

        <!-- Filter Command Palette -->
        <div class="filter-command-palette" id="filterCommandPalette" style="display: none;">
            <div class="filter-palette-overlay"></div>
            <div class="filter-palette-box">
                <input
                    type="text"
                    class="filter-palette-input"
                    id="filterPaletteInput"
                    placeholder="> filter --k --h --15m !!"
                    autocomplete="off"
                />
                <div class="filter-palette-suggestions" id="filterPaletteSuggestions">
                    <!-- Suggestions will be inserted dynamically -->
                </div>
            </div>
        </div>

        <!-- Hidden filter buttons (for backwards compatibility with app.js) -->
        <div style="display: none;">
            <button class="filter-btn" data-filter="category-k" id="filterK">KSWIL</button>
            <button class="filter-btn" data-filter="category-h" id="filterH">HSLU</button>
            <button class="filter-btn" data-filter="category-p" id="filterP">Privat</button>
            <button class="filter-btn" data-filter="category-u" id="filterU">Unterricht</button>
            <button class="filter-btn" data-filter="class-2a" id="filterClass2a">2a</button>
            <button class="filter-btn" data-filter="class-2b" id="filterClass2b">2b</button>
            <button class="filter-btn" data-filter="class-2c" id="filterClass2c">2c</button>
            <button class="filter-btn" data-filter="class-3a" id="filterClass3a">3a</button>
            <button class="filter-btn" data-filter="class-3b" id="filterClass3b">3b</button>
            <button class="filter-btn" data-filter="class-5" id="filterClass5">5</button>
            <button class="filter-btn" data-filter="time-0-15" id="filterTime15">≤15m</button>
            <button class="filter-btn" data-filter="time-16-30" id="filterTime30">16-30m</button>
            <button class="filter-btn" data-filter="time-31-60" id="filterTime60">31-60m</button>
            <button class="filter-btn" data-filter="time-60+" id="filterTime60Plus">60m+</button>
            <button class="filter-btn" data-filter="priority-1" id="filterPriority1">!</button>
            <button class="filter-btn" data-filter="priority-2" id="filterPriority2">!!</button>
            <button class="filter-btn" data-filter="priority-3" id="filterPriority3">!!!</button>
            <button class="filter-btn" data-filter="day-unassigned" id="filterDayUnassigned">Keine</button>
            <button class="filter-btn" data-filter="day-monday" id="filterDayMon">Mo</button>
            <button class="filter-btn" data-filter="day-tuesday" id="filterDayTue">Di</button>
            <button class="filter-btn" data-filter="day-wednesday" id="filterDayWed">Mi</button>
            <button class="filter-btn" data-filter="day-thursday" id="filterDayThu">Do</button>
            <button class="filter-btn" data-filter="day-friday" id="filterDayFri">Fr</button>
            <button class="filter-btn" data-filter="day-saturday" id="filterDaySat">Sa</button>
            <button class="filter-btn" data-filter="day-sunday" id="filterDaySun">So</button>
            <button class="filter-clear-btn" id="clearFilters">× Filter zurücksetzen</button>
        </div>

        <!-- Notes Canvas (Board View) -->
        <main class="notes-canvas" id="notesCanvas">
            <div class="welcome-message" id="welcomeMessage">
                <h2>Willkommen bei Simple Notes</h2>
                <p>Geben Sie unten eine Notiz ein, um zu beginnen...</p>
            </div>
        </main>

        <!-- Kanban View -->
        <main class="kanban-view" id="kanbanView" style="display: none;">
            <div class="kanban-column" data-day="unassigned">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Nicht zugewiesen</h3>
                        <div class="kanban-header-actions">
                            <span class="kanban-count">0</span>
                        </div>
                    </div>
                    <div class="kanban-time-total">0m</div>
                    <button class="kanban-collapse-btn" id="collapseUnassignedBtn" title="Spalte zuklappen">
                        <span class="collapse-icon">‹</span>
                    </button>
                </div>
                <div class="kanban-column-body" data-day="unassigned"></div>
            </div>
            <div class="kanban-column" data-day="monday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Montag</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="monday"></div>
            </div>
            <div class="kanban-column" data-day="tuesday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Dienstag</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="tuesday"></div>
            </div>
            <div class="kanban-column" data-day="wednesday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Mittwoch</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="wednesday"></div>
            </div>
            <div class="kanban-column" data-day="thursday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Donnerstag</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="thursday"></div>
            </div>
            <div class="kanban-column" data-day="friday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Freitag</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="friday"></div>
            </div>
            <div class="kanban-column" data-day="saturday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Samstag</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="saturday"></div>
            </div>
            <div class="kanban-column" data-day="sunday">
                <div class="kanban-column-header">
                    <div class="kanban-header-top">
                        <h3>Sonntag</h3>
                        <span class="kanban-count">0</span>
                    </div>
                    <div class="kanban-time-total">0m</div>
                </div>
                <div class="kanban-column-body" data-day="sunday"></div>
            </div>
        </main>

        <!-- Plan View -->
        <main class="plan-view" id="planView" style="display: none;">
            <!-- Saved Notes Sidebar -->
            <aside class="saved-notes-sidebar" id="savedNotesSidebar" style="display: none;">
                <div class="saved-notes-header">
                    <div class="saved-notes-header-top">
                        <h3>Gespeicherte Notizen</h3>
                        <div class="saved-notes-actions">
                            <span class="saved-notes-count" id="savedNotesCount">0/5</span>
                        </div>
                    </div>
                    <button class="saved-notes-collapse-btn" id="collapseSavedNotesBtn" title="Sidebar zuklappen">
                        <span class="collapse-icon">‹</span>
                    </button>
                </div>
                <div class="saved-notes-list" id="savedNotesList">
                    <!-- Saved notes will be inserted here -->
                </div>
            </aside>

            <div class="plan-main-content">
                <div class="plan-editor-container">
                    <div
                        class="plan-editor"
                        id="planEditor"
                        contenteditable="true"
                        spellcheck="false"
                        data-placeholder="Beginnen Sie mit der Planung...

Shortcuts:
• Cmd+B → Fett
• Cmd+I → Kursiv
• Cmd+Shift+8 → Bullet-Liste
• Cmd+Shift+C → Checkbox
• Alt+X → Checkbox umschalten

Tipp: Schreiben Sie (Task-Name 30m --k) um automatisch eine Aufgabe zu erstellen."
                    ></div>
                    <div class="plan-actions">
                        <button class="plan-action-btn plan-new-btn" id="planNewBtn" title="Neue Notiz erstellen">
                            <span class="action-icon">+</span>
                            <span class="action-label">Neue Notiz</span>
                        </button>
                        <button class="plan-action-btn plan-save-btn" id="planSaveBtn" title="Notiz speichern">
                            <span class="action-icon">⊡</span>
                            <span class="action-label">Speichern</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Input Modal (triggered by 'n' key) -->
        <div class="input-modal" id="inputModal" style="display: none;">
            <div class="input-modal-overlay"></div>
            <div class="input-modal-box">
                <div class="input-modal-header">
                    <span class="input-modal-title">Neue Notiz erstellen</span>
                    <div class="completed-counter" id="completedCounter">0 heute erledigt</div>
                </div>
                <div class="input-wrapper">
                    <span class="input-prompt">&gt;</span>
                    <textarea
                        id="noteInput"
                        class="note-input"
                        placeholder="Neue Notiz oder Todo eingeben..."
                        rows="3"
                    ></textarea>
                </div>
                <div class="input-hint">
                    <span>Enter zum Speichern • ESC zum Schließen • Cmd/Ctrl+Z zum Rückgängig machen</span>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Universal Task/Stack Creator Modal (Cmd+K) -->
    <div class="task-creator-modal" id="taskCreatorModal" style="display: none;">
        <div class="task-creator-overlay"></div>
        <div class="task-creator-box">
            <div class="task-creator-header">
                <span class="task-creator-title">Task / Stack erstellen</span>
                <button class="task-creator-close" id="taskCreatorClose">×</button>
            </div>

            <div class="task-creator-content">
                <!-- Current Task Input -->
                <div class="task-input-section">
                    <div class="task-input-group">
                        <label>Content</label>
                        <input type="text" id="taskCreatorContent" class="task-creator-input" placeholder="Task-Name">
                    </div>

                    <div class="task-input-row">
                        <div class="task-input-group">
                            <label>Zeit</label>
                            <input type="number" id="taskCreatorTime" class="task-creator-input-small" placeholder="30"> min
                        </div>

                        <div class="task-input-group">
                            <label>Kategorie</label>
                            <select id="taskCreatorCategory" class="task-creator-select">
                                <option value="">Keine</option>
                                <option value="k">KSWIL</option>
                                <option value="h">HSLU</option>
                                <option value="p">Privat</option>
                                <option value="u">Unterricht</option>
                            </select>
                        </div>

                        <div class="task-input-group" id="taskCreatorClassGroup" style="display: none;">
                            <label>Klasse</label>
                            <select id="taskCreatorClass" class="task-creator-select">
                                <option value="2a">2a</option>
                                <option value="2b">2b</option>
                                <option value="2c">2c</option>
                                <option value="3a">3a</option>
                                <option value="3b">3b</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>

                    <div class="task-input-row">
                        <div class="task-input-group">
                            <label>Priorität</label>
                            <div class="priority-buttons">
                                <button class="priority-btn" data-value="">Keine</button>
                                <button class="priority-btn" data-value="!">!</button>
                                <button class="priority-btn" data-value="!!">!!</button>
                                <button class="priority-btn" data-value="!!!">!!!</button>
                            </div>
                        </div>

                        <div class="task-input-group">
                            <label>Tag</label>
                            <select id="taskCreatorDay" class="task-creator-select">
                                <option value="">Nicht zugewiesen</option>
                                <option value="monday">Montag</option>
                                <option value="tuesday">Dienstag</option>
                                <option value="wednesday">Mittwoch</option>
                                <option value="thursday">Donnerstag</option>
                                <option value="friday">Freitag</option>
                                <option value="saturday">Samstag</option>
                                <option value="sunday">Sonntag</option>
                            </select>
                        </div>
                    </div>

                    <button class="task-creator-add-btn" id="taskCreatorAddBtn">+ Weitere Task hinzufügen</button>
                </div>

                <!-- Tasks List -->
                <div class="task-creator-list" id="taskCreatorList" style="display: none;">
                    <div class="task-creator-list-header">Tasks:</div>
                    <div class="task-creator-list-items" id="taskCreatorListItems">
                        <!-- Tasks will be inserted here -->
                    </div>
                </div>

                <!-- Stack Options -->
                <div class="task-creator-stack-options" id="taskCreatorStackOptions" style="display: none;">
                    <div class="stack-type-group">
                        <label>Stack-Typ:</label>
                        <div class="stack-type-buttons">
                            <button class="stack-type-btn active" data-type="none">Keine</button>
                            <button class="stack-type-btn" data-type="group">Group (+)</button>
                            <button class="stack-type-btn" data-type="sequential">Sequential (→)</button>
                        </div>
                    </div>

                    <div class="task-input-group" id="taskCreatorStackTitleGroup" style="display: none;">
                        <label>Stack-Titel</label>
                        <input type="text" id="taskCreatorStackTitle" class="task-creator-input" placeholder="Stack-Name">
                    </div>
                </div>
            </div>

            <div class="task-creator-actions">
                <button class="task-creator-cancel" id="taskCreatorCancel">Abbrechen</button>
                <button class="task-creator-submit" id="taskCreatorSubmit">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Session Summary Modal (overlay) -->
    <div class="session-summary-modal" id="sessionSummaryModal" style="display: none;">
        <div class="session-summary-overlay"></div>
        <div class="session-summary-box">
            <div class="session-summary-title">Session beendet!</div>
            <div class="session-summary-content">
                <div class="session-stat">
                    <span class="session-stat-label">Geplant:</span>
                    <span class="session-stat-value" id="sessionPlanned">0m</span>
                </div>
                <div class="session-stat">
                    <span class="session-stat-label">Tatsächlich:</span>
                    <span class="session-stat-value" id="sessionActual">0m</span>
                </div>
                <div class="session-difference" id="sessionDifference">
                    <!-- Will show "+5m schneller" or "-5m länger" -->
                </div>
            </div>
            <button class="session-summary-close" id="sessionSummaryClose">OK</button>
        </div>
    </div>

    <!-- Command Palette -->
    <div class="command-palette" id="commandPalette" style="display: none;">
        <div class="command-palette-overlay"></div>
        <div class="command-palette-content">
            <div class="command-palette-hint">
                <span>↑/↓ zum Navigieren • Cmd loslassen zum Ausführen</span>
            </div>
            <div class="command-palette-body" id="commandPaletteBody">
                <!-- Commands will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Stack Modal -->
    <div class="stack-modal" id="stackModal" style="display: none;">
        <div class="stack-modal-overlay"></div>
        <div class="stack-modal-content">
            <div class="stack-modal-header">
                <div class="stack-modal-title-section">
                    <h3>Stack bearbeiten</h3>
                    <input
                        type="text"
                        id="stackTitleInput"
                        class="stack-title-input"
                        placeholder="Stack-Titel (optional)..."
                    />
                    <div class="stack-type-toggle">
                        <button class="stack-type-btn" id="stackTypeBtn" data-type="group">
                            <span class="stack-type-icon">+</span>
                            <span class="stack-type-label">Gruppe</span>
                        </button>
                        <span class="stack-type-hint">Klick zum Wechseln: Gruppe ↔ Sequenz</span>
                    </div>
                </div>
                <button class="stack-modal-close" id="stackModalClose">&times;</button>
            </div>
            <div class="stack-modal-body" id="stackModalBody">
                <!-- Cards will be inserted here -->
            </div>
        </div>
    </div>

    <script src="app.js?v=47"></script>
    <script src="ui-redesign.js?v=47"></script>
    <script src="task-creator.js?v=47"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
